<html>
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vis-network@latest/styles/vis-network.css" type="text/css" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vis-network@latest/dist/vis-network.min.js"> </script>
    <center>
      <h1></h1>
    </center>

    <!-- <link rel="stylesheet" href="../node_modules/vis/dist/vis.min.css" type="text/css" />
      <script type="text/javascript" src="../node_modules/vis/dist/vis.js"> </script>-->

      <style type="text/css">

#mynetwork {
  width: 1000px;
  height: 800px;
  background-color: #ffffff;
  border: 1px solid lightgray;
  position: relative;
  float: left;
}


      </style>
  </head>

  <body>
    <section>
    <div id = "mynetwork"></div>
    </section>
    <section>
    <div id= "details">
      <p>Some text here</p>
    </div>
    </section>

    <script type="text/javascript">

      // initialize global variables.
      var edges;
      var nodes;
      var network; 
      var container;
      var options, data;
      var nodeCounter;
      var loopCounter;

      function delay(time) {
        return new Promise(resolve => setTimeout(resolve, time));
      }



      function initializeNetwork() {
        var container = document.getElementById('mynetwork');

        nodes = new vis.DataSet();
        edges = new vis.DataSet();

        nodeCounter = 0;
        for (let i = 0; i < 70; i++) {
          addNode(1);
        }
        for (let i = 0; i < 20; i++) {
          addNode(2);
        }
        for (let i = 0; i < 10; i++) {
          addNode(3);
        }

        data = {nodes: nodes, edges: edges};
        var options = {
                      "configure": {
                              "enabled": false
                            },
                      "edges": {
                              "color": {
                                      "inherit": true
                                    },
                              "smooth": {
                                      "enabled": true,
                                      "type": "dynamic"
                                    }
                            },
                      "interaction": {
                              "dragNodes": true,
                              "hideEdgesOnDrag": false,
                              "hideNodesOnDrag": false
                            },
                      "physics": {
                              "enabled": true,
                              "stabilization": {
                                      "enabled": true,
                                      "fit": true,
                                      "iterations": 1000,
                                      "onlyDynamicEdges": false,
                                      "updateInterval": 50
                                    }
                            }
                    };


        network = new vis.Network(container, data, options);

        return network;
      }

      function getRandomInt(max) {
        return 1 + Math.floor(Math.random() * max);
      }

      function addNode(group) {
        nodes.add({"id": nodeCounter, "label": 0, "shape": "dot", "size": 15, "group":group});
        nodeCounter = nodeCounter + 1;
      }

      function addEdge() {
        var from = getRandomInt(nodeCounter-1)
        var to = getRandomInt(nodeCounter-1)
        if(from != to) {
          edges.add({"from": from, "label": 1, "to": to, "weight": 1});
        }
      }

      function addEdgeFrom(from) {
        var to = getRandomInt(nodeCounter-1)
        if(from != to) {
          edges.add({"from": from, "label": 1, "to": to, "weight": 1});
        }
      }

      function incrementNetwork() {
        if(loopCounter > 30) {
          return;
        }
        loopCounter = loopCounter + 1;
        for(let nodeIndex = 0; nodeIndex < nodeCounter; nodeIndex++) {
          var node = nodes.get(nodeIndex);
          var prob = 3;
          var maxNumEdges = 1;
          if(node.group == 2) {
            prob = 7;
            maxNumEdges = 2;
          }
          else if(node.group == 3) {
            prob = 10;
            maxNumEdges = 4;
          }

          if(getRandomInt(100) < prob) {
            var numEdges = getRandomInt(maxNumEdges);
            var from = getRandomInt(nodeCounter-1)
            for (let i = 0; i < numEdges; i++) {
                addEdgeFrom(nodeIndex);
            }
          }
        }
        delayThenIncrement();
      }

      function incrementNetworkOriginal() {
        loopCounter = loopCounter + 1;
        if(loopCounter < 100) {
          if(getRandomInt(10) > 7) {
            addNode(1);
          }
          else {
            if(getRandomInt(10) > 3) {
              addEdge();
            }
            else {
              var numEdges = getRandomInt(4);
              var from = getRandomInt(nodeCounter-1)
              for (let i = 0; i < numEdges; i++) {
                addEdgeFrom(from)
              }
            }
          }

          delayThenIncrement();
        }
      }

      function delayThenIncrement() {
        console.log('delayThenIncrement()')
        delay(1000).then(() => incrementNetwork());
      }

      initializeNetwork();


      loopCounter = 0;
      delayThenIncrement();

    </script>
  </body>
</html>
